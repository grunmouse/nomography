%% Русский чертёжный шрифт
%% Кодировка, идеологически подобна КОИ8, но со следующими отличиями:
%% Поменяны местами заглавные и строчные буквы, чтобы удобнее было набирать транслитерированный текст
%% Задублированы ъ, ь, ё


<<
	%Required for all fonts
	/FontType 3
	/FontMatrix [0.1 0 0 0.1 0 0] %Наклонить потом
	%Required for base fonts
	
	%Кодовая страница. Здесь должны быть мои буквы
	%Кодировка будет отображать введёные буквы первой половины таблицы ASCII на русские буквы
	%Из-за этого выпадают первые 32 символа
	%Для именования букв используется следующая схема:
	% j - й или йотирование гласной в сочетании
	% v - ж
	% w - в
	% x - ь
	% y - ы
	% sh - ш как в "шинус"
	% shx - щ - ш с мягким знаком
	% ch - ч как в "чосинус".
	% er - ъ, еръ
	/Encoding [
%Oct 000 - 177 == 00 - 7F == 0 - 127
%.0			.1			.2			.3			.4			.5			.6			.7
%управляющие символы ASCII
 /.notdef	/.notdef	/.notdef	/.notdef	/.notdef	/.notdef	/.notdef	/.notdef	%00.
 /.notdef	/.notdef	/.notdef	/.notdef	/.notdef	/.notdef	/.notdef	/.notdef	%01.
%управляющие символы ASCII
 /.notdef	/.notdef	/.notdef	/.notdef	/.notdef	/.notdef	/.notdef	/.notdef	%02.
 /.notdef	/.notdef	/.notdef	/.notdef	/.notdef	/.notdef	/.notdef	/.notdef	%03.

 /space		/.notdef	/.notdef	/JO			/jo			/.notdef	/.notdef	/er			%04.
 /.notdef	/.notdef	/.notdef	/.notdef	/.notdef	/.notdef	/.notdef	/.notdef	%05.

 /.notdef	/.notdef	/.notdef	/jo			/.notdef	/.notdef	/.notdef	/.notdef	%06.
 /.notdef	/.notdef	/.notdef	/.notdef	/.notdef	/.notdef	/.notdef	/.notdef	%07.
 
 /JU		/A			/B			/C			/D			/JE			/F			/G			%10.
 /H			/I			/J			/K			/L			/M			/N			/O			%11.

 /P			/JA			/R			/S			/T			/U			/V			/W			%12.
 /X			/Y			/Z			/SH			/E			/SHX		/CH			/ER			%13.

 /ju		/a			/b			/c			/d			/je			/f			/g			%14.
 /h			/i			/j			/k			/l			/m			/n			/o			%15.

 /p			/ja			/r			/s			/t			/u			/v			/w			%16.
 /x			/y			/z			/sh			/e			/shx		/ch			/er			%17.

	] %Кодовая страница. Здесь должны быть мои буквы
	
	/FontBBox [0 0 0 0] %Потом заменить реальными значениями
	
	%Запускается для отрисовки символа
	%[this, charName]
	/BuildGlyph {
		
		%[this, charName]
		1 index 
		%[this, charName, this]
		
		% dup
		% /font-params get begin
			% g a add  0  % Width
			% 0  0  g  h  % Bounding box
			% setcachedevice
		% end
		
		/CharProcs get 
		%[this, charName, this.CharProcs]
		exch % Get CharProcs dictionary
		%[this, this.CharProcs, charName]
		
		2 copy known not % See if charname is known
		{pop /.notdef}
		if
		
		%[this, this.CharProcs, charName]
		get exec % Execute BuildGlyph procedure with [this]
	}
	
	%Устаревшая схема, для совместимости
	%[this, charCode]
	/BuildChar {
		1 index /Encoding 
		%[this, charCode, this.Encoding]
		get exch get
		%[this, charName]
		1 index /BuildGlyph get 
		%[this, charName, this.BuildGlyph]
		exec
	} bind
	
	/font-params <<
		/h 10 %высота прописных букв
		/c 7  %высота строчных букв
		/a 2  %расстояние между буквами
		/b 17 %интерлиньяж
		/e 6  %расстояние между словами
		/d 1  % толщина линии
		
		/h_ 9
		/c_ 6
		/ht 5
		/hb 4
		
		/cm 3
		
		/top {
			0.5 add
		}
		/bot {
			0.5 sub
		}
		%Принимает на вход ширину буквы, устанавливает setcachedevice
		/setconfig {
			/g exch def %определяем g
			/g_ g 1 sub def
			/m g_ 2 div def
			
			g a add  
			0
			% Width
				
			-2  
			-3  
			3 index  
			h 2 add
			% Bounding box
			setcachedevice
			
			d setlinewidth
			
			0.5 0.5 translate
			
			2 setlinecap
		}
		
		%[r, sgndx, sgndy]
		/preparct{
			2 index mul
			%[r, sgndx, dy]
			exch
			2 index mul
			%[r, dy, dx]
			currentpoint
			%[r, dy, dx, x0, y0]
			4 1 roll
			%[r, y0, dy, dx, x0]
			add
			%[r, y0, dy, xn]
			3 1 roll
			%[r, xn, y0, dy]
			add
			%[r, x2, y2]
		}
		
		%Рисует четвертькруговую дугу из точки currentpoint в точку с координатами currentpoint + r{sgndx, sgndy}, начиная по вертикали
		%[r, sgndx, sgndy]
		/arcty {
			preparct
			%[r, x2, y2]
			currentpoint
			%[r, x2, y2, x0, y0]
			%x1 = x0, y1 = y2
			pop
			%[r, x2, y2, x0]
			3 1 roll
			%[r, x0, x2, y2]
			%[r, x0, x2, y2, y2]
			dup
			3 1 roll
			%[r, x0, y2, x2, y2]
			5 -1 roll
			%[x1, y1, x2, y2, r]
			%5 copy (r) == == (2yx) == == == (1yx) == == ==
			arct
		}
		
		%Рисует четвертькруговую дугу из точки currentpoint в точку с координатами currentpoint + r{sgndx, sgndy}, начиная по горизонтали
		%[r, sgndx, sgndy]
		/arctx {
			preparct
			%3 copy (pre 2yx) == == == (pre r) == ==
			%[r, x2, y2]
			currentpoint
			%x1 = x2, y1 = y0
			%[r, x2, y2, x0, y0]
			3 1 roll
			%[r, x2, y0, y2, x0]
			pop
			%[r, x2, y0, y2]
			2 index
			%[r, x2, y0, y2, x2]
			exch
			%[r, x2, y0, x2, y2]
			5 -1 roll
			%[x1, y1, x2, y2, r]
			%5 copy (r) == == (2) == == == (1) == == ==
			arct
		}
		
		%[ldx, r, sgndx, sgndy]
		/rlinearctx {
			4 -1 roll
			%[r, sgndx, sgndy, ldx]
			3 index
			%[r, sgndx, sgndy, ldx, r]
			1 index 
			%[r, sgndx, sgndy, ldx, r, ldx]
			dup abs div %sgn
			%[r, sgndx, sgndy, ldx, r, sgnldx]
			mul
			%[r, sgndx, sgndy, ldx, r*sgnldx]
			sub
			%[r, sgndx, sgndy, sgnldx*(absldx - r)]
			0
			rlineto
			arctx
		}
		
		%[x, r, sgndx, sgndy]
		/tlinearctx {
			4 -1 roll
			currentpoint
			pop
			sub
			4 1 roll
			rlinearctx
		}

		%[y, r, sgndx, sgndy]
		/tlinearcty {
			4 -1 roll
			currentpoint
			exch
			pop
			sub
			4 1 roll
			rlinearcty
		}

		%[ldy, r, sgndx, sgndy]
		/rlinearcty {
			4 -1 roll
			%[r, sgndx, sgndy, ldy]
			3 index
			%[r, sgndx, sgndy, ldy, r]
			1 index 
			%[r, sgndx, sgndy, ldy, r, ldy]
			dup abs div %sgn
			%[r, sgndx, sgndy, ldy, r, sgnldy]
			mul
			%[r, sgndx, sgndy, ldy, r*sgnldy]
			sub
			%[r, sgndx, sgndy, sgnldy*(absldy - r)]
			0
			exch
			rlineto
			arcty
		}
		
		%[w]
		/x {
			0 h_ moveto
			0 0 lineto
			%[w] 
			1 1 1 tlinearctx
			ht 1 -1 1 tlinearcty
			0 ht lineto
		}
		
		
	>>
	
	/CharProcs <<
		/.notdef {}
		/space {			
			/font-params get
			begin
				e
				setconfig
			end
		}
		/A {
			/font-params get
			begin
				7
				setconfig
				1 setlinejoin
				0 0 moveto
				m h_ lineto
				g_ 0 lineto
				1 2 moveto
				g_ 1 sub 2 lineto
				stroke
			end
		}
		/B {
			/font-params get
			begin
				6
				setconfig
				g_ x %нарисовать мягкий знак
				0 h_ moveto
				g_ 1 sub 0 rlineto
				stroke
			end
		}
		/W {
			/font-params get
			begin
				6
				setconfig
				g_ x
				0 h_ moveto
				g_ 1 sub 1 1 -1 tlinearctx
				ht 2 -1 -1 tlinearcty
				stroke
			end
		}
		/G {
			/font-params get
			begin
				4
				setconfig
				0 0 moveto
				0 h_ lineto
				g h_ lineto
				stroke
			end
		}
		/D {
			/font-params get
			begin
				5
				setconfig
				-1 -1 moveto
				-1 0 lineto
				g 0 lineto
				g -1 lineto
				0 0 moveto
				1 setlinejoin 
				1  h_ lineto
				g_ h_  lineto
				0 setlinejoin 
				g_ 0 lineto
				stroke
			end
		}
		/JE {
			/font-params get
			begin
				5
				setconfig
				g_ 0 moveto
				0 0 lineto
				0 h_ lineto
				g_ h_ lineto
				0 
				ht moveto
				3 0 rlineto
				stroke
			end
		}
		/JO {
			dup dup
			/CharProcs get /JE get exec
			/font-params get
			begin
				1 setlinejoin 
				0 setlinecap
				0.5 h_ 2 add moveto
				1 0 rlineto
				1 0 rmoveto
				1 0 rlineto
				stroke
			end
		
		}
		/V {
			/font-params get
			begin
				8
				setconfig
					
				2 setlinecap
				
				m 0 moveto
				m h_ lineto
				
				m ht moveto
				g_ h_ lineto
				m ht moveto
				0 h_ lineto
				
				m ht moveto 1 1 rmoveto
				g_ 0 lineto
				
				m ht moveto -1 1 rmoveto
				0 0 lineto
				stroke
			end
		}
		/Z {
			/font-params get
			begin
				5
				setconfig
				1 setlinecap
				0 1 moveto
				1 1 -1 arcty
				g_ 2 1 1 tlinearctx
				ht 2 -1 1 tlinearcty
				-1 0 rlineto
				1 0 rmoveto
				2 1 1 arctx
				h_ 1 -1 1 tlinearcty
				0 1 -1 -1 tlinearctx
				stroke
			end
		}
		/I {
			/font-params get
			begin
				6
				setconfig
				1 setlinejoin 
				0 h_ moveto
				0 0 lineto
				g_ h_ lineto
				g_ 0 lineto
				stroke
			end
		}
		/J {
			dup dup
			/CharProcs get /I get exec
			/font-params get
			begin
				0 setlinecap
				1 h_ 2 add moveto
				3 0 rlineto
				stroke
			end
		}
		/K {
			/font-params get
			begin
				5
				setconfig
				0 0 moveto
				0 h_ lineto
				0 ht moveto
				g_ h_ lineto
				0 ht moveto 1 1 rmoveto
				g_ 0 lineto
				stroke
		}
		/L {
			/font-params get
			begin
				6
				setconfig
				0 0 moveto
				2 h_ lineto
				g_ h_ lineto
				g_ 0 lineto
				stroke
			end
		}
		/M {
			/font-params get
			begin
				7
				setconfig
				1 setlinejoin 
				0 0 moveto
				0 h_ lineto
				g_ 2 div h_ 2 div lineto
				g_ h_ lineto
				g_ 0 lineto
				stroke
		}
		/N {
			/font-params get
			begin
				6
				setconfig
				0 0 moveto
				0 h_ rlineto
				
				g_ 0 moveto
				0 h_ rlineto
				
				0 ht moveto
				g_ 0 rlineto
				stroke
			end
		}
		/O {
			/font-params get
			begin
				6
				setconfig
				m 0 moveto
				g_ 2 1 1 tlinearctx
				h_ 2 -1 1 tlinearcty
				0 2 -1 -1 tlinearctx
				0 2 1 -1 tlinearcty
				m 0 lineto
				stroke
			end
		}
		/P {
			/font-params get
			begin
				6
				setconfig
				0 0 moveto
				0 h_ lineto
				g_ h_ lineto
				g_ 0 lineto
				stroke
			end
		}
		/R {
			/font-params get
			begin
				6
				setconfig
				0 0 moveto
				0 h_ lineto
				g_ 1 1 -1 tlinearctx
				hb 1 -1 -1 tlinearcty
				0 hb lineto
				stroke
			end
		}
		/S {
			/font-params get
			begin
				5
				setconfig
				g_ 0 moveto
				0  2 -1 1 tlinearctx
				h_ 2 1 1 tlinearcty
				g_ h_ lineto
				stroke
			end
		}
		/T {
			/font-params get
			begin
				6
				setconfig
				m 0 moveto
				0 h_ rlineto
				0 h_ moveto
				g_ 0 rlineto
				stroke
			end
		}
		/U {
			/font-params get
			begin
				6
				setconfig
				0 h_ moveto
				hb 1 1 -1 tlinearcty
				g_ hb lineto
				g_ h_ moveto
				0 2 -1 -1 tlinearcty
				1 0 lineto
				stroke
			end
		}
		/F {
			/font-params get
			begin
				8
				setconfig
				m 0 moveto
				0 h_ rlineto
				m 2 moveto
				0 2 -1 1 tlinearctx
				h_ 2 sub 2 1 1 tlinearcty
				g_ 2 1 -1 tlinearctx
				2 2 -1 -1 tlinearcty
				m 2 lineto
				stroke
			end
		}
		/H {
			/font-params get
			begin
				7
				setconfig
				0 0 moveto
				g_ h_ lineto
				0 h_ moveto
				g_ 0 lineto
				stroke
			end
		}
		/C {
			/font-params get
			begin
				6
				setconfig
				0 h_  moveto
				0 0 lineto
				g 0 lineto
				0 -1 rlineto
				g_ h_ moveto
				g_ 0 lineto
				stroke
			end
		}
		/CH {
			/font-params get
			begin
				6
				setconfig
				0 h_ moveto
				hb 1 1 -1 tlinearcty
				g_ hb lineto
				g_ h_ moveto
				g_ 0 lineto
				stroke
			end
		}
		/SH {
			/font-params get
			begin
				8
				setconfig
				0 h_ moveto
				0 0 lineto
				g_ 0 lineto
				g_ h_ lineto
				m 0 moveto
				0 h_ rlineto
				stroke
			end
		}
		/SHX {
			dup dup
			/CharProcs get /SH get exec
			/font-params get
			begin
				2 setlinecap
				g 0 moveto
				0 -1 rlineto
				stroke
			end
		}
		/ER {
			/font-params get
			begin
				6
				setconfig
				g_ x
				2 setlinecap
				0 h_ moveto
				-2 0 rlineto
				stroke
			end
		}
		/Y {
			/font-params get
			begin
				7
				setconfig
				4 x %нарисовать узкий мягкий знак
				g_ h_ moveto
				g_ 0 lineto
				stroke
			end		
		}
		/X {
			/font-params get
			begin
				6
				setconfig
				g_ x
				stroke
			end		
		}
		/E {
			/font-params get
			begin
				6
				setconfig
				0 0 moveto
				g_ 1 1 1 tlinearctx
				h_ 1 -1 1 tlinearcty
				0 h_ lineto
				g_ ht moveto
				2 ht lineto
				stroke
			end
		}
		/JU {
			/font-params get
			begin
				7
				setconfig
				0 0 moveto
				0 h_ lineto
				0 ht moveto
				2 0 rlineto
				0 1 1 -1 tlinearcty
				g_ 1 1 1 tlinearctx
				h_ 1 -1 1 tlinearcty
				2 1 -1 -1 tlinearctx
				2 ht lineto
				stroke
			end
		}
		/JA {
			/font-params get
			begin
				6
				setconfig
				2 setlinecap
				g_ h_ moveto
				0 1 -1 -1 tlinearctx
				hb 1 1 -1 tlinearcty
				g_ hb lineto
				g_ h_ moveto
				g_ 0 lineto
				m hb moveto
				0 0 lineto
				stroke
			end
		}
		/a {
			/font-params get
			begin
				5 setconfig
				g_ c_ moveto
				0 1 -1 -1 tlinearctx
				0 1 1 -1 tlinearcty
				g_ 1 1 1 tlinearctx
				g_ c_ lineto
				g_ 1 moveto
				1 -1 rlineto
				stroke
			end
		}
		/b {
			/font-params get
			begin
				5 setconfig
				1 setlinejoin
				g_ c_ moveto 0 3 rmoveto
				0 c_ 3 add lineto
				g_ 1 sub c_ lineto
				g_ 1 1 -1 tlinearctx
				0 1 -1 -1 tlinearcty
				0 1 -1 1 tlinearctx
				c_ 1 1 1 tlinearcty
				g_ 1 sub c_ lineto
				stroke
			end
		}
		/w {
			/font-params get
			begin
				5 setconfig
				0 c_ moveto
				g_ 1 1 -1 tlinearctx
				0 1 -1 -1 tlinearcty
				0 1 -1 1 tlinearctx
				c_ 3 add 1 1 1 tlinearcty
				2 1 1 -1 tlinearctx
				1 c_ lineto
				stroke
			end
		}
		/g {}
		/d {
			/font-params get
			begin
				5 setconfig
				0 c_ moveto 1 3 rmoveto
				g_ 1 1 -1 tlinearctx
				0 1 -1 -1 tlinearcty
				0 1 -1 1 tlinearctx
				c_ 1 1 1 tlinearcty
				g_ 1 1 -1 tlinearctx
				stroke
			end
		}
		/je {
			/font-params get
			begin
				5 setconfig
				g_ 0 moveto
				0 1 -1 1 tlinearctx
				c_ 1 1 1 tlinearcty
				g_ 1 1 -1 tlinearctx
				cm 1 -1 -1 tlinearcty
				0 cm lineto
				stroke
			end
		}
		/jo {}
		/v {
			/font-params get
			begin
				7
				setconfig
				m  0  moveto
				m  c_ lineto
				
				m  cm moveto
				g_ c_ lineto

				m  cm moveto
				0  c_ lineto

				m  cm moveto 0.5 0.5 rmoveto
				g_ 0  lineto
				m  cm moveto -0.5 0.5 rmoveto
				0  0  lineto
				stroke
			end
		}
		/z {}
		/i {
			/font-params get
			begin
				5
				setconfig
				0 c_ moveto
				0 1 1 -1 tlinearcty
				g_ 0 lineto
				g_ c_ lineto
				stroke
			end
		}
		/j {
			dup dup
			/CharProcs get /i get exec
			/font-params get
			begin
				%0 setlinecap
				1 c_ 2 add moveto
				2 0 rlineto
				stroke
			end		
		}
		/k {
			/font-params get
			begin
				5
				setconfig
				0 0 moveto
				0 c_ lineto
				0 cm 1 sub moveto
				g_ c_ lineto
				0 cm moveto 2 0.5 rmoveto
				g_ 0 lineto
				stroke
			end
		}
		/l {
			/font-params get
			begin
				5
				setconfig
				1 setlinejoin
				0 0 moveto
				2 c_ lineto
				0 setlinejoin
				g_ c_ lineto
				g_ 0 lineto
				stroke
			end
		}
		/m {
			/font-params get
			begin
				6
				setconfig
				1 setlinejoin
				0 0 moveto
				0 c_ lineto
				m cm lineto
				g_ c_ lineto
				g_ 0 lineto
				stroke
			end
		}
		/n {
			/font-params get
			begin
				5
				setconfig
				0 0 moveto
				0 c_ lineto
				0 cm moveto
				g_ cm lineto
				g_ 0 moveto
				g_ c_ lineto
				stroke
			end
		}
		/o {
			/font-params get
			begin
				5 setconfig
				0 cm moveto
				0 1 1 -1 tlinearcty
				g_ 1 1 1 tlinearctx
				c_ 1 -1 1 tlinearcty
				0 1 -1 -1 tlinearctx
				closepath
				stroke
			end
		}
		/p {
			/font-params get
			begin
				5 setconfig
				0 0 moveto
				0 c_ lineto
				g_ 1 1 -1 tlinearctx
				g_ 0 lineto
				stroke
			end
		}
		/r {
			/font-params get
			begin
				0 c_ moveto
				0 -3 lineto
				0 c_ moveto
				g_ 1 1 -1 tlinearctx
				0 1 -1 -1 tlinearcty
				0 0 lineto
				stroke
			end
		}
		/s {
			/font-params get
			begin
				4 setconfig
				g_ c_ moveto
				0 1 -1 -1 tlinearctx
				0 1 1 -1 tlinearcty
				g_ 0 lineto
				stroke
			end
		}
		/t {
			/font-params get
			begin
				7
				setconfig
				0 0 moveto
				0 c_ lineto
				g_ 1 1 -1 tlinearctx
				g_ 0 lineto
				m c_ moveto
				m 0 lineto
				stroke
			end
		}
		/u {
			/font-params get
			begin
				5
				setconfig
				0 c_ moveto
				0 1 1 -1 tlinearcty
				g_ 0 lineto
				g_ c_ moveto
				-3 2 -1 -1 tlinearcty
				1 -3 lineto
				stroke
			end
		}
		/f {}
		/h {
			/font-params get
			begin
				5
				setconfig
				0 0 moveto
				g_ c_ lineto
				g_ 0 moveto
				0 c_ lineto
				stroke
			end
		}
		/c {
			/font-params get
			begin
				4
				setconfig
				0 c_ moveto
				0 0 lineto
				g 0 lineto
				g -1 lineto
				g_ c_ moveto
				g_ 0 lineto
				stroke
			end
		}
		/ch {
			/font-params get
			begin
				5
				setconfig
				0 c_ moveto
				cm 1 1 -1 tlinearcty
				g_ cm lineto
				g_ c_ moveto
				g_ 0 lineto
				stroke
			end
		}
		/sh {
			/font-params get
			begin
				7 setconfig
				0 c_ moveto
				0 1 1 -1 tlinearcty
				g_ 0 lineto
				g_ c_ lineto
				m 0 moveto
				m c_ lineto
				stroke
			end
		}
		/shx {
			dup dup dup
			/CharProcs get /sh get exec
			/font-params get
			begin
				g 0 moveto
				g -1 lineto
				stroke
			end
		}
		/er {}
		/y {}
		/x {}
		/e {
			/font-params get
			begin
				5 setconfig
				0 0 moveto
				g_ 1 1 1 tlinearctx
				c_ 1 -1 1 tlinearcty
				0 c_ lineto
				g_ cm moveto
				-2 0 rlineto
				stroke
			end
		}
		/ju {}
		/ja {}
	>>
	
>>

/rus-eskd-font exch definefont pop