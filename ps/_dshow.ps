{
	/fontheight { 
		currentfont /ScaleMatrix get 3 get
	} bind def

	% для строки возвращает пару длина высота шрифта
	% [str]
	/stringsize {
		stringwidth pop
		fontheight
	} bind def
} /stringsize ifnotkey



/struct-show {
	dup type /dicttype eq
	{begin doshow end}
	{
		show
	}
	ifelse
} def

/struct-size {
	dup type /dicttype eq
	{begin getsize end}
	{
		stringsize
	}
	ifelse
	
} def

/struct-baseline {
	dup type /dicttype eq
	{begin getbaseline end}
	{0}
	ifelse
} def

%выполняет функцию безопасно для текущего шрифта
%[fun]
/fontsafe {
	0 dict begin
		/fun exch def
		/font currentfont def
		
		fun
		
		font setfont
	end
} def

%[nom, den]
/part {
	0 dict begin
		/den exch def
		/nom exch def
		
		/element-fontscale 0.7 def %размер шрифта элементов по сравнению с основным
		
		% размер шрифта числителя и знаменателя
		/element-fontheight {
			fontheight element-fontscale mul
		} def
		
		
		% рабочие процедуры
		
		% отрисовать себя в текущей позиции
		% сместить текущую точку вправо на ширину отрисованного
		/doshow {
			0 dict begin
				/fraction-line-y fontheight 2 div def % положение черты деления от базовой линии
				/space fontheight 0.25 mul def %отступы от черты деления и удлинение её концов
				{
					currentfont element-fontscale scalefont setfont %уменишить шрифт
					
					%рассчитываем характерные размеры элементов
					nom struct-baseline
					/nom-baseline exch def
					nom struct-size
					/nom-height exch def
					/nom-width exch def

					den struct-baseline
					/den-baseline exch def
					den struct-size
					/den-height exch def
					/den-width exch def
					
					%рассчитываем общую ширину дроби
					/width 
						nom-width
						den-width
						max
						exch
						pop
						
						space 2 mul add
					def
					gsave
						currentpoint translate 
						width 2 div fraction-line-y translate
						%Устанавливаем начало координат на середину линии
						
						nom-width 2 div neg
						space nom-baseline add %отступаем отступ и высоту базовой линии
						moveto
						nom struct-show
						
						den-width 2 div neg
						space den-height den-baseline sub add neg %отступаем отступ и разность высоты и базовой линии
						moveto
						den struct-show
						
						0 0 moveto
						width 0 lineto
						stroke
					grestore
					
				} fontsafe
				
				width 0 rmoveto
			end
		} def
		
		%вернуть свои высоту и ширину
		/getsize {
			0 dict begin
				/fraction-line-y fontheight 2 div def % положение черты деления от базовой линии
				/space fontheight 0.25 mul def %отступы от черты деления и удлинение её концов
				{
					currentfont element-fontscale scalefont setfont %уменишить шрифт
					
					%рассчитываем характерные размеры элементов
					nom struct-size
					/nom-height exch def
					/nom-width exch def

					den struct-size
					/den-height exch def
					/den-width exch def
					
					%рассчитываем общую ширину дроби
					/width 
						nom-width
						den-width
						max
						exch
						pop
						
						space 2 mul add
					def
					
					/height
						nom-heigth
						den-heigth
						add
						space 2 mul add
					def
				} fontsafe
				
				width heigth
			end
		} def
		
		%вернуть положение своей базовой линии (от низа контейнера)
		/getbaseline {
			0 dict begin
				/fraction-line-y fontheight 2 div def % положение черты деления от базовой линии
				/space fontheight 0.25 mul def %отступы от черты деления и удлинение её концов
				{
					currentfont element-fontscale scalefont setfont %уменишить шрифт
					
					%рассчитываем характерные размеры элементов
					den struct-size
					/den-height exch def
					/den-width exch def
					
				} fontsafe
				
				den-height space add
				fraction-line-y sub

			end			
		} def
		
		currentdict % вернуть полученный словарь - он теперь структура
	end
} def